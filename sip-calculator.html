<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIP Calculator</title>
    <link rel="stylesheet" href="common.css">
    <style>
        canvas {
            max-width: 300px;
            max-height: 300px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>SIP Calculator</h1>
        <p class="subtitle">Calculate your investment returns with Systematic Investment Plan</p>

        <div class="slider-group">
            <label for="currency">Currency</label>
            <select id="currency">
                <option value="USD">USD ($)</option>
                <option value="EUR">EUR (€)</option>
                <option value="GBP">GBP (£)</option>
                <option value="SEK" selected>SEK (kr)</option>
                <option value="INR">INR (₹)</option>
                <option value="JPY">JPY (¥)</option>
                <option value="AUD">AUD (A$)</option>
                <option value="CAD">CAD (C$)</option>
            </select>
        </div>

        <div class="slider-group">
            <div class="slider-header">
                <label for="monthly-investment">Monthly Investment</label>
                <span class="slider-value" id="monthly-value">kr 5,000</span>
            </div>
            <input type="range" id="monthly-investment" min="500" max="100000" step="500" value="5000">
        </div>

        <div class="slider-group">
            <div class="slider-header">
                <label for="return-rate">Expected Return Rate (p.a.)</label>
                <span class="slider-value" id="return-value">12%</span>
            </div>
            <input type="range" id="return-rate" min="1" max="30" step="0.5" value="12">
        </div>

        <div class="slider-group">
            <div class="slider-header">
                <label for="time-period">Time Period</label>
                <span class="slider-value" id="time-value">10 Yrs</span>
            </div>
            <input type="range" id="time-period" min="1" max="40" step="1" value="10">
        </div>

        <div id="results" class="results">
            <div class="result-item">
                <span class="result-label">Invested Amount</span>
                <span class="result-value" id="invested-amount">-</span>
            </div>
            <div class="result-item">
                <span class="result-label">Estimated Returns</span>
                <span class="result-value" id="est-returns">-</span>
            </div>
            <div class="result-item">
                <span class="result-label">Total Value</span>
                <span class="result-value highlight" id="total-value">-</span>
            </div>

            <div class="chart-container">
                <canvas id="pie-chart" width="300" height="300"></canvas>
            </div>
        </div>
    </div>

    <script>
        const currencySymbols = {
            'USD': '$',
            'EUR': '€',
            'GBP': '£',
            'SEK': 'kr',
            'INR': '₹',
            'JPY': '¥',
            'AUD': 'A$',
            'CAD': 'C$'
        };

        // DOM elements
        const currencySelect = document.getElementById('currency');
        const monthlySlider = document.getElementById('monthly-investment');
        const returnSlider = document.getElementById('return-rate');
        const timeSlider = document.getElementById('time-period');
        const monthlyValueDisplay = document.getElementById('monthly-value');
        const returnValueDisplay = document.getElementById('return-value');
        const timeValueDisplay = document.getElementById('time-value');

        function formatCurrency(amount, currency) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: currency,
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(amount);
        }

        function formatSliderCurrency(amount) {
            const currency = currencySelect.value;
            const symbol = currencySymbols[currency];
            return symbol + ' ' + amount.toLocaleString();
        }

        function updateSliderDisplays() {
            monthlyValueDisplay.textContent = formatSliderCurrency(parseFloat(monthlySlider.value));
            returnValueDisplay.textContent = returnSlider.value + '%';
            timeValueDisplay.textContent = timeSlider.value + ' Yrs';
        }

        function calculateSIP() {
            const monthlyInvestment = parseFloat(monthlySlider.value);
            const annualRate = parseFloat(returnSlider.value);
            const years = parseFloat(timeSlider.value);
            const currency = currencySelect.value;

            // Convert annual rate to monthly rate using compound interest formula
            const annualRateDecimal = annualRate / 100;
            const monthlyRate = Math.pow(1 + annualRateDecimal, 1/12) - 1;

            // Total number of months
            const months = years * 12;

            // SIP Formula: M = P × ([1 + i]^n – 1) / i) × (1 + i)
            const futureValue = monthlyInvestment *
                (Math.pow(1 + monthlyRate, months) - 1) / monthlyRate *
                (1 + monthlyRate);

            const investedAmount = monthlyInvestment * months;
            const estimatedReturns = futureValue - investedAmount;

            // Display results
            document.getElementById('invested-amount').textContent = formatCurrency(investedAmount, currency);
            document.getElementById('est-returns').textContent = formatCurrency(estimatedReturns, currency);
            document.getElementById('total-value').textContent = formatCurrency(futureValue, currency);

            // Draw pie chart
            drawPieChart(investedAmount, estimatedReturns);
        }

        function drawPieChart(invested, returns) {
            const canvas = document.getElementById('pie-chart');
            const ctx = canvas.getContext('2d');
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = 120;

            const total = invested + returns;
            const investedAngle = (invested / total) * 2 * Math.PI;
            const returnsAngle = (returns / total) * 2 * Math.PI;

            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Draw invested amount slice
            ctx.beginPath();
            ctx.moveTo(centerX, centerY);
            ctx.arc(centerX, centerY, radius, 0, investedAngle);
            ctx.closePath();
            ctx.fillStyle = 'rgb(14, 165, 233)';
            ctx.fill();

            // Draw returns slice
            ctx.beginPath();
            ctx.moveTo(centerX, centerY);
            ctx.arc(centerX, centerY, radius, investedAngle, investedAngle + returnsAngle);
            ctx.closePath();
            ctx.fillStyle = 'rgb(34, 197, 94)';
            ctx.fill();

            // Add labels
            ctx.fillStyle = 'rgb(17, 24, 39)';
            ctx.font = 'bold 14px system-ui';
            ctx.textAlign = 'center';

            // Invested label
            const investedLabelAngle = investedAngle / 2;
            const investedLabelX = centerX + Math.cos(investedLabelAngle) * (radius / 1.5);
            const investedLabelY = centerY + Math.sin(investedLabelAngle) * (radius / 1.5);
            ctx.fillText('Invested', investedLabelX, investedLabelY);

            // Returns label
            const returnsLabelAngle = investedAngle + returnsAngle / 2;
            const returnsLabelX = centerX + Math.cos(returnsLabelAngle) * (radius / 1.5);
            const returnsLabelY = centerY + Math.sin(returnsLabelAngle) * (radius / 1.5);
            ctx.fillText('Returns', returnsLabelX, returnsLabelY);
        }

        // Event listeners for sliders
        monthlySlider.addEventListener('input', function() {
            updateSliderDisplays();
            calculateSIP();
        });

        returnSlider.addEventListener('input', function() {
            updateSliderDisplays();
            calculateSIP();
        });

        timeSlider.addEventListener('input', function() {
            updateSliderDisplays();
            calculateSIP();
        });

        // Currency change updates displays and recalculates
        currencySelect.addEventListener('change', function() {
            updateSliderDisplays();
            calculateSIP();
        });

        // Initialize on page load
        window.addEventListener('load', function() {
            updateSliderDisplays();
            calculateSIP();
        });
    </script>
</body>
</html>
